{{extend layout}}

{{block content_tool}}
{{if request.user.is_superuser:}}
    <a class="btn btn-blue" href="{{=get_model_url('add')}}">{{=add_button_text}}</a>
{{pass}}
{{end}}

{{block content_main}}
{{use "jquery"}}
{{use "jqpagination"}}
{{use "jsquery"}}
{{use "fgbutton"}}
<script type="text/javascript">
  $(function(){
      var width = $(window).width() - 270;
      if ($('#content_main').width() > width){
        $('#content_main').width(width);
      }
//    $('#content_main').next('.box-bottom').width($('#content_main table').width());
  });
</script>
<div id="content_main" style="overflow-x:auto;padding-bottom:20px;">
{{embed table}}
</div>
<div id="pagination" class="right"></div>
<div class="left">共有：<font color="red">{{=info['total']}}</font> 条记录</div>
<script type="text/javascript">
var load_content = function(new_page_index){
    new_page_index = new_page_index||0;
//    var filter = $('#sel_type').find('a.ui-state-active').attr('rel');
//    var query_string = $.query.set('pageno', new_page_index).set('filter', filter).toString();
    var query_string = $.query.set('pageno', new_page_index).set('data', '').toString();
    $.ajax({
      type: 'POST',
      url: "{{=get_model_url('list')}}" + query_string,
      dataType: 'json',
      success: function(data){
            $('#{{=table_id}}').find('tbody').html(data.table);
        }
    });
}

function handlePaginationClick(new_page_index, pagination_container) {
        // This selects 20 elements from a content array
        load_content(new_page_index);
        return false;
    }

$(function(){
    $("#pagination").pagination({{=info['total']}}, {
            items_per_page:{{=info['rows_per_page']}},
            prev_text:'上一页',
            next_text:'下一页',
            first_call:true,
            current_page:{{=info['pageno']}},
            callback:handlePaginationClick
        });
});
</script>

{{end}}